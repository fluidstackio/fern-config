The Python script on this page provides an example of how the [FluidStack API](/api-reference) can be used to manage instances programmatically.

## Prerequisites
  - <Markdown src="../../snippets/api-key.mdx" />
  - A [public/private key pair](/ssh/use-ssh-keys#generate-a-publicprivate-key-pair)
  - Basic familiarity with [Python](https://python.org) and Python 3+ installed
  - The [`requests`](https://pypi.org/project/requests/) module installed in your Python environment

## Script overview

<Steps>
  ### Create an SSH key

    The script reads the public key located at `~/.ssh/id_rsa.pub`, then sends a request to the [`Create an SSH key`](/api-reference/ssh-keys/create) endpoint to create a SSH key named `"python_testkey"`. This SSH key is a copy of the public key that was read.

    <Warning>
      - If you already have an SSH key named `python_testkey`, change the script to use a different, unique name.
      - If your public key is in a different location or filename, make sure to update this part of the script.
    </Warning>

  ### Create an instance

    The script creates an instance by sending a request to the [`Create a new instance`](/api-reference/instances/create) endpoint.
    
    The API key is sent in the request as a header. The SSH key name, configuration, and operating system template are sent in the JSON body of the request.

  ### Check the instance status

    Initially, the instance's `status` is `pending`. The script repeatedly checks this `status` until it is `running` by sending requests to the [`List user instances`](/api-reference/instances/list) endpoint and parsing the response. 

    This status-checking loop stops once the instance's `status` returns as `running`, or if its `status` indicates that it has been `terminated` or is otherwise unable to run.

  ### Print the instance IP

    Once the instance's status is `running`, the script prints the instance's IP address.

  ### Delete the instance

    Finally, the script deletes the created instance.
</Steps>
 

<Tip>To run this script, make sure to replace `<your_api_key>` in line 7 with your own API key.</Tip>

## Example script 

```python maxLines=30 title="Python" {14,34,56,78,81}
import requests
from pathlib import Path
import os
import time
import json

api_url = "https://platform.fluidstack.io/"
api_key = "<your_api_key>"

headers = {
    "api-key": api_key
}

# 1: Create an SSH key
print("Creating SSH key")
ssh_key_name = "python_testkey"

# The next line reads the public key from ~/.ssh/id_rsa.pub - change this if your public key is somewhere different
public_key = open(os.path.join(Path.home(), ".ssh", "id_rsa.pub")).read().strip() 
r = requests.post(
    api_url + "ssh_keys",
    headers=headers,
    json={"name": ssh_key_name, "public_key": public_key}, # Create a SSH key using the provided public key
)

if not r.ok:
    print("Response body: " + json.dumps(r.json(), indent=2))
    raise Exception("Could not create SSH key")

gpu_type = "RTX_A4000_16GB"
gpu_count = 4
operating_system_label = "ubuntu_20_04_lts"

# 2: Create an instance 
print("Creating instance")
r = requests.post(
    api_url + "instances",
    headers=headers,
    json={
        "name": "python_testinstance",
        "ssh_key": ssh_key_name,
        "gpu_type": gpu_type,
        "gpu_count": gpu_count,
        "operating_system_label": operating_system_label
    }
)
print("Response body: " + json.dumps(r.json(), indent=2))
if not r.ok:
    raise Exception("Could not create instance")
	
instance_id = r.json()["id"]

instance_status = "pending"
print("Waiting for instance to start")

# 3: Check the instance status
# This while loop checks the instance status every 10 seconds and exits when the status is "running"
count = 1
while instance_status != "running":
    if instance_status in ["unhealthy", "terminated", "shutting_down", "stopping", "stopped"]:
        print("Could not create instance")
        raise Exception("Could not create instance")
    try:
        r = requests.get(api_url + "instances", headers=headers)
        instances = r.json()
        instance = None
        for instance in instances:
            if instance["id"] == instance_id:
                instance_status = instance["status"]
                break
        instance_status = instance["status"]
    except Exception as e:
        print(e)
    print("\t [" + str(count) + "] Status: " + instance_status)
    time.sleep(10)
    count += 1

# 4: Print the instance IP
print("Instance IP address: " + instance["ip_address"])

# 5: Delete the instance
print("Deleting instance")
r = requests.delete(api_url + f"instances/{instance_id}", headers=headers)
if not r.ok:
    print("Response body: " + json.dumps(r.json(), indent=2))
    raise Exception("Could not delete instance")
print("Instance deleted")
```