The [Python script on this page](#script) provides an example of how the [FluidStack API](/api-reference) can be used to manage instances programmatically.

## Requirements
  - <Markdown src="../snippets/api-key.mdx" />
  - A [public/private key pair](/authentication#public-key)
  - [Python 3+](https://python.org)

## Summary of script steps

<Steps>
    ### Create an SSH key

      The script reads the public key from the default location (`~/.ssh/id_rsa.pub`) and sends a POST request to create a new SSH key named `"my_key"`.

    ### Create an instance

      The script creates an instance, specifying the API and SSH keys, GPU Type, GPU count, and operating system.

    ### Check the instance status

      The script checks the status of the created instance until it is running.

    ### Print the instance IP

      Once the instance is running, the script prints the instance IP.

    ### Delete the instance

      Finally, the script deletes the created instance.
</Steps>
 

<Tip>To run this script, make sure to replace `<your_api_key>` in line 7 with your own API key.</Tip>

## Script 

```python maxLines=30 title="Python"
import requests
from pathlib import Path
import os
import time

api_url = "https://platform.fluidstack.io/"
api_key = "<your_api_key>"

# Provide the API key in a header
headers = {
    "api-key": api_key
}

# 1: Create an SSH key
print("Creating SSH key")
public_key = open(os.path.join(Path.home(), ".ssh", "id_rsa.pub")).read().strip() # Read the public key from the home directory
r = requests.post(
    url + "ssh_keys",
    headers=headers,
    json={"name": "my_key", "public_key": public_key}, # Create a new SSH key with the name "my_key", using the provided public key
)
if not r.ok:
    raise Exception("Could not create SSH key")

ssh_key_names = [r.json()["name"]]

gpu_type = "RTX_A6000_48GB"
gpu_count = 4
operating_system_label = 'ubuntu_20_04_lts'

# 2: Create an instance 
print("Creating instance")
r = requests.post(
    url + "instances",
    headers=headers,
    json={
        "name" : "myinstance",
        "ssh_keys": [ssh_key_names[0]],
        "gpu_type": gpu_type,
        "gpu_count": gpu_count,
        "operating_system_label": operating_system_label,
    },
)
	if not r.ok:
	    print(r.json())
	else:
		raise Exception("Could not create instance")
	
instance_id = r.json()['id']

instance_status = "pending"
print("Waiting for instance to start")

# 3: Check the instance status
# This while loop checks the instance status every 10 seconds and exits when the status is "running"
while instance_status != "running":
    if instance_status in ["unhealthy"]:
        print("Could not create instance")
        raise Exception("Could not create instance")
    try
        r = requests.get(url + "instances", headers=headers)
        instances = r.json()
        instance = None
        for instance in instances:
            if instance['id'] == instance_id:
                instance_status = instance['status']
                break
        instance_status = instance['status']
    except Exception as e:
        print(e)
    print("\t [" + str(count) + "] Status: " + instance_status)
    time.sleep(10)

# 4: Print the instance IP
print("Instance IP address: " + instance['public_ip'])

# 5: Delete the instance
print("Deleting instance")
r = requests.delete(url + f"instances/{instance_id}", headers=headers)
if not r.ok:
    print(r.json())
    raise Exception("Could not delete instance")
print("Instance deleted")

```
