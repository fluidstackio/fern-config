The Python script on this page provides an example of how the [FluidStack API](/api-reference) can be used to manage instances programmatically.

## Prerequisites
  - <Markdown src="../snippets/api-key.mdx" />
  - A [public/private key pair](/get-started#create-a-publicprivate-key-pair)
  - [Python 3+](https://python.org)

## Script overview

<Steps>
  ### Create an SSH key

    The script reads the public key located at `~/.ssh/id_rsa.pub` and sends a POST request to create a new SSH key named `"python_testkey"`.

    <Warning>
      - If you already have a SSH key named `python_testkey`, change the script to use a different, unique name.
      - If your public key is in a different location or filename, make sure to update this part of the script.
    </Warning>

  ### Create an instance

    The script creates an instance, specifying the API and SSH keys, GPU Type, GPU count, and operating system.

  ### Check the instance status

    The script checks the status of the created instance until it is `running`.

  ### Print the instance IP

    Once the instance is `running`, the script prints the instance's IP address.

  ### Delete the instance

    Finally, the script deletes the created instance.
</Steps>
 

<Tip>To run this script, make sure to replace `<your_api_key>` in line 7 with your own API key.</Tip>

## Example script 

```python maxLines=30 title="Python" {15,33,55,77,80}
import requests
from pathlib import Path
import os
import time
import json

api_url = "https://platform.fluidstack.io/"
api_key = "<your_api_key>"

# Provide the API key in a header
headers = {
    "api-key": api_key
}

# 1: Create an SSH key
print("Creating SSH key")
public_key = open(os.path.join(Path.home(), ".ssh", "id_rsa.pub")).read().strip() # Read the public key from ~/.ssh/id_rsa.pub - change this if your public key is somewhere different
r = requests.post(
    api_url + "ssh_keys",
    headers=headers,
    json={"name": "python_testkey", "public_key": public_key}, # Create a new SSH key with the name "python_testkey", using the provided public key
)
if not r.ok:
    print("Response body: " + json.dumps(r.json(), indent=2))
    raise Exception("Could not create SSH key")

ssh_key_names = [r.json()["name"]]

gpu_type = "RTX_A4000_16GB"
gpu_count = 4
operating_system_label = "ubuntu_20_04_lts"

# 2: Create an instance 
print("Creating instance")
r = requests.post(
    api_url + "instances",
    headers=headers,
    json={
        "name": "python_testinstance",
        "ssh_keys": ssh_key_names,
        "gpu_type": gpu_type,
        "gpu_count": gpu_count,
        "operating_system_label": operating_system_label
    }
)
print("Response body: " + json.dumps(r.json(), indent=2))
if not r.ok:
    raise Exception("Could not create instance")
	
instance_id = r.json()["id"]

instance_status = "pending"
print("Waiting for instance to start")

# 3: Check the instance status
# This while loop checks the instance status every 10 seconds and exits when the status is "running"
count = 1
while instance_status != "running":
    if instance_status in ["unhealthy", "terminated", "shutting_down", "stopping", "stopped"]:
        print("Could not create instance")
        raise Exception("Could not create instance")
    try:
        r = requests.get(api_url + "instances", headers=headers)
        instances = r.json()
        instance = None
        for instance in instances:
            if instance["id"] == instance_id:
                instance_status = instance["status"]
                break
        instance_status = instance["status"]
    except Exception as e:
        print(e)
    print("\t [" + str(count) + "] Status: " + instance_status)
    time.sleep(10)
    count += 1

# 4: Print the instance IP
print("Instance IP address: " + instance["ip_address"])

# 5: Delete the instance
print("Deleting instance")
r = requests.delete(api_url + f"instances/{instance_id}", headers=headers)
if not r.ok:
    print("Response body: " + json.dumps(r.json(), indent=2))
    raise Exception("Could not delete instance")
print("Instance deleted")
```